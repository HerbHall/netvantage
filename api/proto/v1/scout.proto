syntax = "proto3";

package netvantage.v1;

option go_package = "github.com/HerbHall/netvantage/api/proto/v1;scoutpb";

// ScoutService defines the communication between Scout agents and the NetVantage server.
service ScoutService {
  // CheckIn sends a periodic heartbeat from agent to server.
  rpc CheckIn(CheckInRequest) returns (CheckInResponse);

  // ReportMetrics streams system metrics from agent to server.
  rpc ReportMetrics(stream MetricsReport) returns (Ack);

  // CommandStream establishes a bidirectional stream for server-to-agent commands.
  rpc CommandStream(stream CommandResponse) returns (stream Command);
}

message CheckInRequest {
  string agent_id = 1;
  string hostname = 2;
  string platform = 3;
  string agent_version = 4;
  SystemMetrics metrics = 5;
}

message CheckInResponse {
  bool acknowledged = 1;
  int32 check_interval_seconds = 2;
  repeated string pending_commands = 3;
}

message SystemMetrics {
  double cpu_percent = 1;
  double memory_percent = 2;
  double memory_used_bytes = 3;
  double memory_total_bytes = 4;
  repeated DiskMetric disks = 5;
  repeated NetworkMetric networks = 6;
}

message DiskMetric {
  string mount_point = 1;
  double total_bytes = 2;
  double used_bytes = 3;
  double free_bytes = 4;
}

message NetworkMetric {
  string interface_name = 1;
  double bytes_sent = 2;
  double bytes_recv = 3;
}

message MetricsReport {
  string agent_id = 1;
  int64 timestamp = 2;
  SystemMetrics metrics = 3;
}

message Ack {
  bool success = 1;
}

message Command {
  string id = 1;
  string type = 2;
  bytes payload = 3;
}

message CommandResponse {
  string command_id = 1;
  bool success = 2;
  bytes output = 3;
  string error = 4;
}
